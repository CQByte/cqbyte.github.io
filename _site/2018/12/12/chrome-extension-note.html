<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome extension 开发小记 - Frank</title>
    <meta name="author"  content="cqbyte">
    <meta name="description" content="Chrome extension 开发小记">
    <meta name="keywords"  content="">
    <!-- Open Graph -->
    <meta property="og:title" content="Chrome extension 开发小记 - Frank">
    <meta property="og:type" content="website">
    <meta property="og:url" content="http://localhost:4000/2018/12/12/chrome-extension-note.html">
    <meta property="og:description" content="Frank de 技术博客">
    <meta property="og:site_name" content="Frank">
    <link rel="stylesheet" href="//cdn.staticfile.org/normalize/6.0.0/normalize.min.css">
    <link rel="stylesheet" href="//at.alicdn.com/t/font_roc50gemkxpw4s4i.css">
<!--    <link rel="stylesheet" href="/assets/css/github-markdown.css">-->
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/share.min.css">
    <link rel="stylesheet" href="/assets/css/app.min.css">
    <link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <script src="https://cdn.staticfile.org/jquery/3.2.1/jquery.min.js"></script>
	
	<!--
Author: Ray-Eldath
refer to:
 - http://docs.mathjax.org/en/latest/options/index.html
-->

	<script type="text/javascript" async src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
		jax: ["input/TeX", "output/HTML-CSS"],
		tex2jax: {
			inlineMath: [ ["$", "$"] ],
			displayMath: [ ["$$", "$$"] ],
			skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
		},
		"HTML-CSS": { preferredFont: "TeX", availableFonts: ["STIX","TeX"] }
      });
    </script>

	
    <!--
Author: Ray-Eldath
-->
<style>
    .markdown-body .anchor{
        float: left;
        margin-top: -8px;
        margin-left: -20px;
        padding-right: 4px;
        line-height: 1;
        opacity: 0;
    }
    
    .markdown-body .anchor .anchor-icon{
        font-size: 15px
    }
</style>
<script>
    $(document).ready(function() {
        let nodes = document.querySelector(".markdown-body").querySelectorAll("h1,h2,h3")
        for(let node of nodes) {
            var anchor = document.createElement("a")
            var anchorIcon = document.createElement("i")
            anchorIcon.setAttribute("class", "fa fa-anchor fa-lg anchor-icon")
            anchorIcon.setAttribute("aria-hidden", true)
            anchor.setAttribute("class", "anchor")
            anchor.setAttribute("href", "#" + node.getAttribute("id"))
            
            anchor.onmouseover = function() {
                this.style.opacity = "0.4"
            }
            
            anchor.onmouseout = function() {
                this.style.opacity = "0"
            }
            
            anchor.appendChild(anchorIcon)
            node.appendChild(anchor)
        }
    })
</script>
</head>


<body>
  <!--[if lt IE 10]>
<div class="alert-danger" role="alert">你的浏览器实在太太太旧了，放学别走，升级完浏览器再说！<a target="_blank" class="alert-link" href="http://browsehappy.com">立即升级</a></div>
<![endif]-->
  <input id="nm-switch" type="hidden" value="false"> <header class="g-header">
    <div class="g-logo">
      <a href="/"></a>
    </div>
    <i id="menu-toggle" class="iconfont icon-menu"></i>
    <nav class="g-nav">
        <ul>
            
            <li><a href="/">home</a></li>
            
            <li><a href="/tags.html">tags</a></li>
            
        </ul>
    </nav>
</header>


  <header
    class="g-banner post-header post-pattern-circuitBoard bgcolor-pink post-no-cover"
    data-theme="pink"
  >
    <div class="post-wrapper">
      <div class="post-tags">
        
      </div>
      <h1>Chrome extension 开发小记</h1>
      <div class="post-meta">
        <span class="post-meta-item"><i class="iconfont icon-author"></i>cqbyte</span>
        <time class="post-meta-item" datetime="18-12-12"><i class="iconfont icon-date"></i>12 Dec 2018</time>
      </div>
    </div>
    
  </header>

  <div class="post-content visible">
    

    <article id="content" class="main-content markdown-body" rol="main" >
      <p>官方介绍：<a href="https://developer.chrome.com/extensions">What are extensions?</a></p>

<p>follow教程 <a href="https://developer.chrome.com/extensions/getstarted">Getting Started Tutorial</a>
<br /></p>

<blockquote>
  <p>项目目录 <code class="highlighter-rouge">~/demo_chrome_extension</code></p>
</blockquote>

<h3 id="1-manifest">1. Manifest</h3>
<p>创建一个 Manifest 文件：<code class="highlighter-rouge">~/demo_chrome_extension/manifest.json</code></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>{
  "name": "Getting Started Example",
  "version": "1.0",
  "description": "Build an Extension!",
  "manifest_version": 2
}
</code></pre></div></div>
<p>新建一个图标文件夹 <code class="highlighter-rouge">~/demo_chrome_extension/images/</code> 并注册到 <code class="highlighter-rouge">manifest</code>：</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Getting Started Example"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Build an Extension!"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"icons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"16"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started16.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"32"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started32.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"48"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started48.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"128"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started128.png"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"manifest_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<blockquote>
  <p>在 Chrome 的开发者模式（<code class="highlighter-rouge">chrome://extensions</code>），我们可以加载直接包含 <code class="highlighter-rouge">manifest</code> 文件的本地扩展源码目录。</p>
</blockquote>

<p>即使只有一个 <code class="highlighter-rouge">manifest.json</code>，我们也可以把它安装到chrome，虽然它什么都干不了</p>

<p><img src="http://localhost:4000/assets/images/QQ20190321-134636.png" alt="工具栏显示" />
<img src="http://localhost:4000/assets/images/chrome_extension-01.png" alt="详情" /></p>

<h3 id="2-背景页">2. 背景页</h3>
<p>新建一个 js 文件：<code class="highlighter-rouge">~/demo_chrome_extension/background.js</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>chrome.runtime.onInstalled.addListener(function() {
  chrome.storage.sync.set({color: '#3aa757'}, function() {
    console.log("The color is green.");
  });
});
</code></pre></div></div>
<p>这段目前不需要理解的代码调用了一个需要申请权限的接口 <code class="highlighter-rouge">chrome.storage</code>，
在 <code class="highlighter-rouge">manifest</code> 中注册这个脚本并声明所需权限：</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code> {
    "name": "Getting Started Example",
    "version": "1.0",
    "description": "Build an Extension!",
    "permissions": ["storage"],
    "background": {
      "scripts": ["background.js"],
      "persistent": false
    },
    "manifest_version": 2
  }
</code></pre></div></div>

<p>现在刷新一下，点击查看视图后面的 <code class="highlighter-rouge">背景页</code> 链接，就可以看到 background 脚本的控制台输出。
<img src="http://localhost:4000/assets/images/QQ20190321-135328.png" alt="背景页" /></p>

<h3 id="3-交互界面">3. 交互界面</h3>
<p>chrome扩展提供许多种不同形式的用户界面，我们先试一下 <strong>popup</strong> （弹出窗口）。
点击chrome工具栏上的扩展图标弹出的就是 popup 页面。</p>

<p>首先新建一个名为 <code class="highlighter-rouge">popup</code> 的html文件：
<code class="highlighter-rouge">~/demo_chrome_extension/popup.html</code></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;style&gt;</span>
      <span class="nt">button</span> <span class="p">{</span>
        <span class="nl">height</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
        <span class="nl">width</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
        <span class="nl">outline</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="nt">&lt;/style&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"changeColor"</span><span class="nt">&gt;&lt;/button&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>然后在 <code class="highlighter-rouge">manifest</code> 中注册这个页面：</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Getting Started Example"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Build an Extension!"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"background"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"background.js"</span><span class="p">],</span><span class="w">
    </span><span class="s2">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  
  </span><span class="s2">"page_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"default_popup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"popup.html"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"icons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"16"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started16.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"32"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started32.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"48"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started48.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"128"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started128.png"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"manifest_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>这个时候扩展图标还是灰色的，点击也不会弹出 popup 页面。我们还需要在 background 脚本中告诉chrome什么时候用户可以和 popup 页面交互。</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">chrome</span><span class="p">.</span><span class="nx">runtime</span><span class="p">.</span><span class="nx">onInstalled</span><span class="p">.</span><span class="nx">addListener</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'I</span><span class="se">\'</span><span class="s1">m installed!'</span><span class="p">);</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">declarativeContent</span><span class="p">.</span><span class="nx">onPageChanged</span><span class="p">.</span><span class="nx">removeRules</span><span class="p">(</span><span class="kc">undefined</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">chrome</span><span class="p">.</span><span class="nx">declarativeContent</span><span class="p">.</span><span class="nx">onPageChanged</span><span class="p">.</span><span class="nx">addRules</span><span class="p">([{</span>
      <span class="na">conditions</span><span class="p">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">declarativeContent</span><span class="p">.</span><span class="nx">PageStateMatcher</span><span class="p">({</span>
        <span class="na">pageUrl</span><span class="p">:</span> <span class="p">{</span><span class="na">hostEquals</span><span class="p">:</span> <span class="s1">'developer.chrome.com'</span><span class="p">},</span>
      <span class="p">})],</span>
      <span class="na">actions</span><span class="p">:</span> <span class="p">[</span><span class="k">new</span> <span class="nx">chrome</span><span class="p">.</span><span class="nx">declarativeContent</span><span class="p">.</span><span class="nx">ShowPageAction</span><span class="p">()]</span>
    <span class="p">}]);</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>想要调用 <code class="highlighter-rouge">chrome.declarativeContent</code> 接口我们还需要再声明一个权限 <code class="highlighter-rouge">declarativeContent</code>。</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Getting Started Example"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1.0"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"description"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Build an Extension!"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"storage"</span><span class="p">,</span><span class="w"> </span><span class="s2">"declarativeContent"</span><span class="p">],</span><span class="w">
  </span><span class="s2">"background"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"scripts"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"background.js"</span><span class="p">],</span><span class="w">
    </span><span class="s2">"persistent"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"page_action"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"default_popup"</span><span class="p">:</span><span class="w"> </span><span class="s2">"popup.html"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"icons"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"16"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started16.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"32"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started32.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"48"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started48.png"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"128"</span><span class="p">:</span><span class="w"> </span><span class="s2">"images/get_started128.png"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"manifest_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>重新加载扩展，如果当前页面URL域名是 <code class="highlighter-rouge">https://developer.chrome.com/</code>，工具栏上的扩展图标会变回彩色，点击图标会弹出我们的 popup 页面。</p>

<h3 id="4-popup-页面逻辑">4. popup 页面逻辑</h3>

<p>popup 页面的脚本需要写在单独的 <code class="highlighter-rouge">popup.js</code> 文件，然后可以直接在 <code class="highlighter-rouge">popup.html</code> 中引用：</p>

<p><code class="highlighter-rouge">~/demo_chrome_extension/popup.js</code></p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">changeColor</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'changeColor'</span><span class="p">);</span>

<span class="nx">chrome</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="s1">'color'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">changeColor</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">color</span><span class="p">;</span>
  <span class="nx">changeColor</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="s1">'value'</span><span class="p">,</span> <span class="nx">data</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div></div>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  ...
  <span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"changeColor"</span><span class="nt">&gt;&lt;/button&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"popup.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<p>重新加载扩展demo可以看到按钮背景变为绿色。下面继续扩展 popup 的逻辑，当点击按钮时把当前页面背景色设为绿色：</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">//popup.js</span>
<span class="p">...</span>
<span class="nx">changeColor</span><span class="p">.</span><span class="nx">onclick</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">let</span> <span class="nx">color</span> <span class="o">=</span> <span class="nx">element</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">value</span><span class="p">;</span>
  <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">query</span><span class="p">({</span><span class="na">active</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span> <span class="na">currentWindow</span><span class="p">:</span> <span class="kc">true</span><span class="p">},</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tabs</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">chrome</span><span class="p">.</span><span class="nx">tabs</span><span class="p">.</span><span class="nx">executeScript</span><span class="p">(</span>
        <span class="nx">tabs</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">id</span><span class="p">,</span>
        <span class="p">{</span><span class="na">code</span><span class="p">:</span> <span class="s1">'document.body.style.backgroundColor = "'</span> <span class="o">+</span> <span class="nx">color</span> <span class="o">+</span> <span class="s1">'";'</span><span class="p">});</span>
  <span class="p">});</span>
<span class="p">};</span>
</code></pre></div></div>
<p>ps: 需要声明权限：<code class="highlighter-rouge">activeTab</code></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Getting Started Example"</span><span class="p">,</span><span class="w">
</span><span class="err">...</span><span class="w">
  </span><span class="s2">"permissions"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"activeTab"</span><span class="p">,</span><span class="w"> </span><span class="s2">"declarativeContent"</span><span class="p">,</span><span class="w"> </span><span class="s2">"storage"</span><span class="p">],</span><span class="w">
</span><span class="err">...</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h3 id="5-交互界面配置页">5. 交互界面——配置页</h3>
<p>新建 <code class="highlighter-rouge">options.html</code> 文件并注册到 manifest ：
<code class="highlighter-rouge">~/demo_chrome_extension/options.html</code></p>
<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cp">&lt;!DOCTYPE html&gt;</span>
  <span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
      <span class="nt">&lt;style&gt;</span>
        <span class="nt">button</span> <span class="p">{</span>
          <span class="nl">height</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
          <span class="nl">width</span><span class="p">:</span> <span class="m">30px</span><span class="p">;</span>
          <span class="nl">outline</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
          <span class="nl">margin</span><span class="p">:</span> <span class="m">10px</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="nt">&lt;/style&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
      <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"buttonDiv"</span><span class="nt">&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
      <span class="nt">&lt;div&gt;</span>
        <span class="nt">&lt;p&gt;</span>Choose a different background color!<span class="nt">&lt;/p&gt;</span>
      <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"options.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
  <span class="nt">&lt;/html&gt;</span>
</code></pre></div></div>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Getting Started Example"</span><span class="p">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
  </span><span class="s2">"options_page"</span><span class="p">:</span><span class="w"> </span><span class="s2">"options.html"</span><span class="p">,</span><span class="w">
  </span><span class="err">...</span><span class="w">
  </span><span class="s2">"manifest_version"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p>别忘了js也要放到单独的文件
<code class="highlighter-rouge">~/demo_chrome_extension/options.js</code></p>
<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">page</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">'buttonDiv'</span><span class="p">);</span>
  <span class="kd">const</span> <span class="nx">kButtonColors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">'#3aa757'</span><span class="p">,</span> <span class="s1">'#e8453c'</span><span class="p">,</span> <span class="s1">'#f9bb2d'</span><span class="p">,</span> <span class="s1">'#4688f1'</span><span class="p">];</span>
  <span class="kd">function</span> <span class="nx">constructOptions</span><span class="p">(</span><span class="nx">kButtonColors</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">item</span> <span class="k">of</span> <span class="nx">kButtonColors</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">let</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">'button'</span><span class="p">);</span>
      <span class="nx">button</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">backgroundColor</span> <span class="o">=</span> <span class="nx">item</span><span class="p">;</span>
      <span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">'click'</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">chrome</span><span class="p">.</span><span class="nx">storage</span><span class="p">.</span><span class="nx">sync</span><span class="p">.</span><span class="kd">set</span><span class="p">({</span><span class="na">color</span><span class="p">:</span> <span class="nx">item</span><span class="p">},</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s1">'color is '</span> <span class="o">+</span> <span class="nx">item</span><span class="p">);</span>
        <span class="p">})</span>
      <span class="p">});</span>
      <span class="nx">page</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">button</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">constructOptions</span><span class="p">(</span><span class="nx">kButtonColors</span><span class="p">);</span>
</code></pre></div></div>
<p>重新加载扩展，现在可以打开 <code class="highlighter-rouge">扩展程序选项了</code>
<img src="http://localhost:4000/assets/images/QQ20190321-155648.png" alt="进入选项页" /></p>

<p>哒哒~ ok啦</p>

    </article>

    
    <div class="social-share-wrapper">
      <div class="social-share"></div>
    </div>
    
  </div>

  <section class="author-detail">
    <section class="post-footer-item author-card">
      <div class="avatar">
        <img src="https://avatars0.githubusercontent.com/u/16101554?s=460&v=4" alt="">
      </div>
      <div class="author-name" rel="author">cqbyte</div>
      <div class="bio">
        <p>你的美丽影响我敲码了</p>
      </div>
      
      <ul class="sns-links">
        
        <li>
          <a href="//github.com/cqbyte" target="_blank">
                    <i class="iconfont icon-github"></i>
                </a>
        </li>
        
      </ul>
      
    </section>
    <section class="post-footer-item read-next">
      
      <div class="read-next-item">
        <a href="/2018/12/12/chrome-extension.html" class="read-next-link"></a>
        <section>
          <span>Chrome 扩展</span>
          <p>  名为 manifest.json 的 manifest 文件是必须的，浏览器从这个文件获取扩展程序的相关信息，...</p>
        </section>
        
     </div>
      

      
      <div class="read-next-item">
        <a href="/2018/12/12/Liquid.html" class="read-next-link"></a>
          <section>
            <span>Liquid 模板语言</span>
            <p>使用 Ruby 实现的开源、安全、面向客户的模板语言，用于构建灵活的 web 应用。</p>
          </section>
          
      </div>
      
    </section>
    
  </section>

  <footer class="g-footer">
  <section>Frank ©
  
  
    2018
    -
  
  2019
  </section>
  <section>Powered by <a href="//jekyllrb.com">Jekyll</a> | <a href="https://github.com/kaeyleo/jekyll-theme-H2O">Theme H2O</a></section>
</footer>


  <script src="/assets/js/social-share.min.js"></script>
  <script>
    socialShare('.social-share', {
      sites: [
        
          'wechat'
          ,
          
        
          'weibo'
          ,
          
        
          'twitter'
          
        
      ],
      wechatQrcodeTitle: "分享到微信朋友圈",
      wechatQrcodeHelper: '<p>扫码后点击右上角</p><p>将本文分享至朋友圈</p>'
    });
  </script>

  

  <script src="/assets/js/prism.js"></script>
  <script src="/assets/js/index.min.js"></script>
</body>

</html>
